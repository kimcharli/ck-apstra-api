<!DOCTYPE html>
<html lang="en"><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apstra Database Backup</title>
<link rel="stylesheet" href="/ck-apstra-api/assets/css/style.css"> <body><header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/ck-apstra-api/">CK Apstra API</a>
        <nav class="site-nav">
            <a href="/ck-apstra-api/notes/database-backup">Database Backup</a>
            <!-- Add more navigation links as needed -->
        </nav>
    </div>
</header> <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Apstra Database Backup</h1>
  </header>

  <div class="post-content">
    <h1 id="apstra-database-backup">Apstra Database Backup</h1>

<h2 id="overview">Overview</h2>

<p>The procedure for backing up the Apstra database is described in the <a href="https://www.juniper.net/documentation/us/en/software/apstra5.1/apstra-user-guide/topics/task/apstra-server-database-back-up.html">Back up Apstra Database</a>.</p>

<p>The procedure above doesn’t mention the way to copy over the database to a remote server, here are the steps to do that.</p>

<h2 id="steps-to-backup-and-transfer-database">Steps to Backup and Transfer Database</h2>

<h3 id="step-1-create-database-backup">Step 1: Create Database Backup</h3>
<p>Login to the Apstra server as admin and take a backup of the database.</p>

<div class="command-block">
  <p>admin@aos-server:~$ sudo aos_backup
[sudo] password for admin: 
Including secret keys from the backup
Include all sysdb files
====================================================================
  Backup operation completed successfully.
====================================================================
New AOS snapshot: <span class="snapshot-name">2025-02-14_23-09-45</span>
admin@aos-server:~$</p>
</div>

<h3 id="step-2-create-compressed-archive">Step 2: Create Compressed Archive</h3>
<p>Create a compressed archive of the backup. Note: Replace <snapshot-name> with your actual backup timestamp.</snapshot-name></p>
<div class="command-block">
  <p>admin@aos-server:~$ sudo tar zcf aos-backup-<span class="snapshot-name">2025-02-14_23-09-45</span>.tgz /var/lib/aos/snapshot/<span class="snapshot-name">2025-02-14_23-09-45</span>
tar: Removing leading `/’ from member names
admin@aos-server:~$</p>
</div>

<h3 id="step-3-set-file-permissions">Step 3: Set File Permissions</h3>
<p>Change the ownership of the backup file.</p>
<div class="command-block">
  <p>admin@aos-server:~$ sudo chown admin aos-backup-<span class="snapshot-name">2025-02-14_23-09-45</span>.tgz</p>
</div>

<h3 id="step-4-transfer-the-backup">Step 4: Transfer the Backup</h3>
<p>Choose one of the following methods to transfer the backup file. Replace the IP address and path with your target server details.</p>

<h4 id="option-a-push-from-apstra-server-to-remote-server">Option A: Push from Apstra server to remote server</h4>
<div class="command-block">
  <p>scp aos-backup-<span class="snapshot-name">2025-02-14_23-09-45</span>.tgz admin@10.1.1.100:/home/admin/</p>
</div>

<h4 id="option-b-pull-from-remote-server-to-apstra-server">Option B: Pull from remote server to Apstra server</h4>
<div class="command-block">
  <p>scp admin@aos-server:/home/admin/aos-backup-<span class="snapshot-name">2025-02-14_23-09-45</span>.tgz .</p>
</div>

<h4 id="option-c-using-winscp">Option C: Using WinSCP</h4>
<p>Use the WinSCP graphical interface to transfer the file. Ensure you have SSH access configured properly.</p>

<h3 id="best-practices">Best Practices</h3>
<ul>
  <li>Always verify the backup file size after transfer
    <div class="command-block">
      <p>ls -lh aos-backup-<span class="snapshot-name">2025-02-14_23-09-45</span>.tgz</p>
    </div>
  </li>
  <li>Keep backups in a secure location</li>
  <li>Consider automating this process for regular backups: <a href="https://supportportal.juniper.net/s/article/Juniper-Apstra-Automating-Backup-Collection">KB37808 Automating Backup Collection</a></li>
  <li>Maintain proper backup rotation to manage storage space</li>
</ul>


  </div>

</article>

      </div>
    </main><footer class="site-footer">
    <div class="wrapper">
        <p>&copy; 2025 CK Apstra API</p>
    </div>
</footer> </body>

</html>
