---
layout: post
title: "Database Backup"
date: 2025-02-15
---

## 1. Overview

The procedure for backing up the Apstra database is described in the [Back up Apstra Database](https://www.juniper.net/documentation/us/en/software/apstra5.1/apstra-user-guide/topics/task/apstra-server-database-back-up.html).

The procedure above doesn't mention the way to copy over the database to a remote server, here are the steps to do that.

## 2. Steps to Backup and Transfer Database

### Step 1: Create Database Backup

Login to the Apstra server as admin and take a backup of the database.

```sh
admin@aos-server:~$ sudo aos_backup
[sudo] password for admin: 
Including secret keys from the backup
Include all sysdb files
====================================================================
  Backup operation completed successfully.
====================================================================
New AOS snapshot: 2025-02-14_23-09-45
admin@aos-server:~$ 
```

{% include note.html content="  " %}
> The name of the snapshot is generated by apstra each time. It is `2025-02-14_23-09-45` in this case.

> You choose the name of the compressed file. It is helpful to maintain the snapshot name in cases.
> It is `aos-backup-2025-02-14_23-09-45.tgz` in this case.

### Step 2: Create Compressed Archive

Create a compressed archive of the backup.

```sh
admin@aos-server:~$ sudo tar zcf aos-backup-2025-02-14_23-09-45.tgz /var/lib/aos/snapshot/2025-02-14_23-09-45
tar: Removing leading `/' from member names
admin@aos-server:~$ 
```

{% include note.html content="" %}
> The compressed file is created in the admin user home folder - /home/admin.

### Step 3: Set File Permissions

Change the ownership of the backup file.

```sh
admin@aos-server:~$ sudo chown admin aos-backup-2025-02-14_23-09-45.tgz
```

{% include note.html content="  " %}
> Default admin user is `admin`.

### Step 4: Transfer the Backup

Choose one of the following methods to transfer the backup file. Replace the IP address and path with your target server details.

#### Option A: Push from Apstra server to remote server

```sh
scp aos-backup-2025-02-14_23-09-45.tgz fileserver-user@10.0.0.50:/path/to/the/backup/folder
```

{% include note.html content="" %}
> The remote server is 10.0.0.50 in this case.

#### Option B: Pull from remote server to Apstra server

```sh
scp admin@10.0.0.20:/home/admin/aos-backup-2025-02-14_23-09-45.tgz .
```

{% include note.html content="" %}
> The address of the Apstra controller is 10.0.0.20 in this case.

#### Option C: Using WinSCP

In case of Windows environment, use tools like WinSCP.

## 3. Best Practices

- Always verify the backup file size after transfer

    ```
    ls -lh aos-backup-2025-02-14_23-09-45.tgz
    ```

- Keep backups in a secure location
- Consider automating this process for regular backups
  - [KB37808 Automating Backup Collection](https://supportportal.juniper.net/s/article/Juniper-Apstra-Automating-Backup-Collection)
- Implement a backup retention policy to automatically delete old backups
  - e.g. using a tool like logrotate